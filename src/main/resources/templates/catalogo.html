<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo Premium - Golden Feets</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        :root {
            --purple-900: #3B1C5F;
            --purple-700: #5B21B6;
            --purple-600: #6D28D9;
            --purple-500: #7C3AED;
            --purple-100: #EDE9FE;
            --purple-50: #F5F3FF;

            --gray-900: #111827;
            --gray-600: #4B5563;
            --gray-100: #F3F4F6;
            --white: #FFFFFF;

            --gradient-primary: linear-gradient(135deg, var(--purple-600), var(--purple-900));
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(109, 40, 217, 0.3);

            --radius-card: 20px;
            --font-sans: 'Inter', sans-serif;
            --font-serif: 'Playfair Display', serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-sans);
            background-color: #FAFAFA;
            color: var(--gray-900);
        }

        /* === HEADER PREMIUM === */
        .header-premium {
            background: linear-gradient(135deg, #2D1548 0%, #4C1D95 50%, #3B1C5F 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 0;
        }

        .brand-premium {
            font-family: var(--font-serif);
            font-weight: 900;
            font-size: 1.8rem;
            background: linear-gradient(135deg, #fff 0%, #E9D5FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            text-decoration: none;
        }

        .search-premium .input-group-text {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-right: none;
            color: rgba(255, 255, 255, 0.7);
        }

        .search-premium input {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-left: none;
            color: white;
        }
        .search-premium input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .search-premium input:focus {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            box-shadow: none;
            border-color: rgba(255, 255, 255, 0.3);
        }

        .nav-btn-premium {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            border-radius: 12px;
        }
        .nav-btn-premium:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            color: white;
        }
        .nav-btn-premium .badge {
            background: var(--purple-500) !important;
            border: 2px solid var(--purple-900);
        }

        /* === SIDEBAR FILTROS === */
        .filter-card {
            background: var(--white);
            border-radius: var(--radius-card);
            border: 1px solid var(--gray-100);
            box-shadow: var(--shadow-card);
            position: sticky;
            top: 2rem;
        }
        .filter-header { border-bottom: 2px solid var(--purple-100); }
        .filter-title { font-family: var(--font-serif); color: var(--purple-900); font-weight: 800; }

        .category-link {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            color: var(--gray-600);
            font-weight: 600;
            transition: all 0.3s ease;
            display: block;
            text-decoration: none;
            border: 1px solid transparent;
            margin-bottom: 0.5rem;
        }
        .category-link:hover {
            background: var(--purple-50);
            color: var(--purple-700);
            transform: translateX(5px);
        }
        .category-link.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(109, 40, 217, 0.3);
        }

        input[type=range] {
            accent-color: var(--purple-600);
            height: 6px;
            background: var(--purple-100);
            border-radius: 5px;
            width: 100%;
        }

        /* === CARD PRODUCTO PREMIUM === */
        .product-card-premium {
            background: var(--white);
            border-radius: var(--radius-card);
            border: 1px solid var(--gray-100);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .product-card-premium:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
            border-color: transparent;
        }

        .product-card-premium::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: var(--radius-card);
            padding: 2px;
            background: var(--gradient-primary);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.4s;
            pointer-events: none;
        }
        .product-card-premium:hover::before { opacity: 1; }

        .card-img-wrapper {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            background: var(--gray-100);
        }
        .card-img-top {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .product-card-premium:hover .card-img-top { transform: scale(1.08); }

        .badge-discount {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #EF4444, #B91C1C);
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.4);
            border-radius: 8px;
            font-weight: 800;
            letter-spacing: 0.05em;
            padding: 0.5rem 0.8rem;
            z-index: 2;
            color: white;
        }

        .btn-favorite {
            position: absolute;
            top: 1rem;
            left: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.9);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            color: var(--gray-600);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 2;
        }
        .btn-favorite:hover { transform: scale(1.15); color: #EF4444; }
        .btn-favorite.active { background: #EF4444; color: white; }

        .card-body-premium {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex-grow: 1;
        }
        .product-category {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 800;
            color: var(--gray-600);
            letter-spacing: 0.1em;
        }
        .product-title {
            font-weight: 800;
            font-size: 1.1rem;
            margin: 0;
            color: var(--gray-900);
        }

        .price-box {
            margin-top: auto;
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
            padding-top: 1rem;
        }
        .price-current {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--purple-600);
        }
        .price-old {
            text-decoration: line-through;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .btn-add-cart {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            padding: 0.7rem;
            transition: 0.3s;
        }
        .btn-add-cart:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(109, 40, 217, 0.4);
        }
        .btn-quick-view {
            background: white;
            border: 2px solid var(--gray-100);
            border-radius: 12px;
            width: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            transition: 0.3s;
        }
        .btn-quick-view:hover {
            border-color: var(--purple-600);
            color: var(--purple-600);
            background: var(--purple-50);
        }

        /* === MODAL PREMIUM === */
        .modal-content-premium {
            border-radius: 24px;
            border: none;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        .modal-body-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }
        @media (max-width: 992px) {
            .modal-body-grid { grid-template-columns: 1fr; }
        }

        .gallery-section {
            background: var(--gray-100);
            padding: 2.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .main-img-box {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-card);
            background: white;
            aspect-ratio: 1;
        }
        .main-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .details-section {
            padding: 2.5rem;
            background: white;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
        }
        .modal-close-btn {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            box-shadow: var(--shadow-card);
            z-index: 10;
            transition: 0.3s;
        }
        .modal-close-btn:hover {
            transform: rotate(90deg);
            color: var(--purple-600);
        }

        .modal-title-lg {
            font-family: var(--font-serif);
            font-size: 2.2rem;
            font-weight: 900;
            line-height: 1.1;
            color: var(--gray-900);
        }
        .spec-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            background: var(--purple-50);
            padding: 1.5rem;
            border-radius: 16px;
        }
        .spec-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 800;
            color: var(--purple-700);
        }
        .spec-value {
            font-weight: 700;
            color: var(--gray-900);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-up { animation: fadeInUp 0.6s ease forwards; }
        .form-select-premium {

    border: 2px solid var(--gray-100);
    border-radius: 12px;
    padding: 0.75rem;
    font-weight: 600;
    color: var(--gray-600);
    transition: all 0.3s;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%236D28D9' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m2 5 6 6 6-6'/%3e%3c/svg%3e");
}
.form-select-premium:focus {
    border-color: var(--purple-600);
    box-shadow: 0 0 0 4px var(--purple-50);
    color: var(--purple-900);
}
    </style>
</head>
<body>

<header class="header-premium sticky-top">
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="brand-premium d-flex align-items-center gap-2" th:href="@{/}">
                <i class="bi bi-gem" style="font-size: 1.5rem; -webkit-text-fill-color: #fff;"></i>
                Golden Feets
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="mainNavbarContent">
                <div class="d-flex flex-column flex-lg-row align-items-center w-100 mt-3 mt-lg-0 gap-3">

                    <form th:action="@{/catalogo}" method="get" class="mx-lg-auto w-100" style="max-width: 500px;">
                        <div class="input-group search-premium">
                            <span class="input-group-text rounded-start-pill ps-3"><i class="bi bi-search"></i></span>
                            <input type="text" name="busqueda" class="form-control rounded-end-pill py-2"
                                   placeholder="Buscar zapatillas, botas..." th:value="${param.busqueda}">
                        </div>
                    </form>

                    <div class="d-flex align-items-center gap-3">
                        <a th:href="@{/lista_deseos}" class="btn nav-btn-premium position-relative d-flex align-items-center gap-2 px-3 py-2" title="Lista de Deseos">
                            <i class="bi bi-heart"></i>
                            <span class="d-none d-xl-inline font-weight-bold small">Deseos</span>
                            <span id="wishlist-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill">0</span>
                        </a>

                        <a th:href="@{/carrito}" class="btn nav-btn-premium position-relative d-flex align-items-center gap-2 px-3 py-2">
                            <i class="bi bi-bag"></i>
                            <span class="d-none d-xl-inline font-weight-bold small">Carrito</span>
                            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill">0</span>
                        </a>
                        <div class="nav-item d-none d-lg-block">
                            <a th:href="${usuario != null ? '/perfil' : '/login'}"
                               class="nav-link text-white d-flex align-items-center gap-2"
                               title="Mi Cuenta">

                                <div class="rounded-circle bg-white text-primary d-flex align-items-center justify-content-center fw-bold shadow-sm"
                                     style="width: 35px; height: 35px;">

            <span th:if="${usuario != null}"
                  th:text="${usuario.nombre.substring(0,1).toUpperCase()}">ID</span>

                                    <i th:if="${usuario == null}" class="bi bi-person-fill" style="font-size: 1.2rem;"></i>

                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<main class="container py-5">

    <div class="d-flex align-items-end justify-content-between mb-5 animate-fade-up">
        <div>
            <h1 class="display-4 fw-bold" style="font-family: var(--font-serif); color: var(--purple-900);">
                Colecci√≥n Exclusiva
            </h1>
            <p class="text-muted fs-5 mb-0">Dise√±o y confort en cada paso.</p>
        </div>
        <div class="text-end d-none d-md-block">
            <span class="badge bg-light text-dark border rounded-pill px-3 py-2">
                <span th:text="${productos.size()}">0</span> productos encontrados
            </span>
        </div>
    </div>

    <div class="row g-4">
        <aside class="col-lg-3 animate-fade-up" style="animation-delay: 0.1s;">
            <form th:action="@{/catalogo}" method="get" class="filter-card p-4">
                <div class="filter-header pb-3 mb-4 d-flex align-items-center gap-2">
                    <i class="bi bi-sliders text-purple-600"></i>
                    <h5 class="filter-title m-0">Filtros</h5>
                </div>

                <div class="mb-4">
                    <label class="text-uppercase small fw-bold text-muted mb-3 d-block">Categor√≠as</label>
                    <div class="d-flex flex-column gap-2">
                        <a th:href="@{/catalogo}" class="category-link" th:classappend="${param.categoria == null} ? 'active'">
                            Todo el calzado
                        </a>
                        <a th:each="cat : ${categorias}"
                           th:href="@{/catalogo(categoria=${cat.nombre})}"
                           class="category-link"
                           th:classappend="${param.categoria == cat.nombre} ? 'active'"
                           th:text="${cat.nombre}">
                        </a>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="text-uppercase small fw-bold text-muted mb-3 d-block">Precio M√°ximo</label>
                    <h3 class="fw-bold mb-2" style="color: var(--purple-600);" id="price-display">
                        $<span th:text="${param.precioMax != null ? #numbers.formatDecimal(param.precioMax, 1, 'POINT', 0, 'COMMA') : '500,000'}">500,000</span>
                    </h3>
                    <input type="range" id="price-range" name="precioMax" min="50000" max="500000" step="10000"
                           th:value="${param.precioMax != null ? param.precioMax : 500000}">
                </div>

                <button type="submit" class="btn w-100 py-3 fw-bold text-white mt-2"
                        style="background: var(--purple-900); border-radius: 12px;">
                    Aplicar Filtros
                </button>
            </form>
        </aside>

        <div class="col-lg-9">
            <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4" id="productos-container">
                <div class="col animate-fade-up" style="animation-delay: 0.2s;" th:each="producto : ${productos}">
                    <div class="product-card-premium">
                        <button class="btn-favorite" th:attr="data-id=${producto.id},onclick='toggleFavorite(this, ' + ${producto.id} + ')'">
                            <i class="bi bi-heart"></i>
                        </button>

                        <div class="card-img-wrapper">
                            <img th:src="${producto.imagenUrl}" class="card-img-top" th:alt="${producto.nombre}">
                        </div>

                        <span th:if="${producto.originalPrice != null and producto.originalPrice > producto.precio}"
                              class="badge badge-discount">
                            OFERTA
                        </span>

                        <div class="card-body-premium">
                            <div>
                                <div class="product-category" th:text="${producto.nombreCategoria != null ? producto.nombreCategoria : 'Golden Feets'}">Golden Feets</div>
                                <h3 class="product-title" th:text="${producto.nombre}">Producto</h3>
                            </div>

                            <div class="price-box">
                                <span class="price-current">$<span th:text="${#numbers.formatDecimal(producto.precio, 1, 'POINT', 0, 'COMMA')}">0</span></span>
                                <span th:if="${producto.originalPrice != null}" class="price-old">$<span th:text="${#numbers.formatDecimal(producto.originalPrice, 1, 'POINT', 0, 'COMMA')}">0</span></span>
                            </div>

                            <div class="actions-grid">
                                <button type="button"
                                        th:attr="onclick='quickViewPremium(' + ${producto.id} + ')'"
                                        class="btn-add-cart w-100">
                                    <i class="bi bi-bag-plus-fill me-2"></i> A√±adir
                                </button>

                                <button type="button"
                                        th:attr="onclick='quickViewPremium(' + ${producto.id} + ')'"
                                        class="btn-quick-view"
                                        title="Vista R√°pida">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${productos == null || productos.isEmpty()}" class="col-12 text-center py-5">
                    <i class="bi bi-search display-1 text-muted opacity-25"></i>
                    <h3 class="mt-3 text-muted">No encontramos productos con esos filtros</h3>
                    <a th:href="@{/catalogo}" class="btn btn-link" style="color: var(--purple-600);">Ver todo el cat√°logo</a>
                </div>
            </div>
        </div>
    </div>
</main>

<div class="modal fade" id="premiumModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content modal-content-premium" id="modal-content-wrapper">
            <div class="p-5 text-center">
                <div class="spinner-border text-primary" role="status"></div>
            </div>
        </div>
    </div>
</div>

<div id="toast-notification" class="position-fixed bottom-0 end-0 p-3" style="z-index: 2050"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // ============================================
  // REEMPLAZA TODO EL <script> AL FINAL DE TU catalogo.html
  // ============================================

  const formatter = new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', maximumFractionDigits: 0 });
  let favorites = JSON.parse(localStorage.getItem('goldenFeetsFavorites')) || [];

  // Definimos las opciones disponibles
  const availableSizes = Array.from({length: 12}, (_, i) => i + 30); // [30, 31, ... 41]
  const availableColors = ["Negro", "Blanco", "Rojo", "Azul", "Verde", "Gris", "Beige", "Cafe", "Rosa", "Amarillo", "Multicolor"];

  document.addEventListener('DOMContentLoaded', () => {
      initFavorites();
      updateCartCount();
      updateWishlistCount();

      const range = document.getElementById('price-range');
      const display = document.getElementById('price-display');
      if(range) {
          range.addEventListener('input', (e) => {
              const formattedValue = new Intl.NumberFormat('es-CO').format(e.target.value);
              display.querySelector('span').innerText = formattedValue;
          });
      }
  });

  // ============================================
  // FAVORITOS (Sin cambios)
  // ============================================
  function initFavorites() {
      document.querySelectorAll('.btn-favorite').forEach(btn => {
          const id = parseInt(btn.dataset.id);
          if(favorites.includes(id)) {
              btn.classList.add('active');
              btn.querySelector('i').classList.replace('bi-heart', 'bi-heart-fill');
          }
      });
  }

  function toggleFavorite(btn, id) {
      const icon = btn.querySelector('i');
      if(favorites.includes(id)) {
          favorites = favorites.filter(f => f !== id);
          btn.classList.remove('active');
          icon.classList.replace('bi-heart-fill', 'bi-heart');
          showToast('Eliminado de favoritos', 'info');
      } else {
          favorites.push(id);
          btn.classList.add('active');
          icon.classList.replace('bi-heart', 'bi-heart-fill');
          showToast('A√±adido a favoritos', 'success');
      }
      localStorage.setItem('goldenFeetsFavorites', JSON.stringify(favorites));
      updateWishlistCount();
  }

  function updateWishlistCount() {
      const wishlistCountElement = document.getElementById('wishlist-count');
      if (wishlistCountElement) wishlistCountElement.textContent = favorites.length;
  }

  // ============================================
  // VISTA PREVIA CON SELECTORES DE VARIANTES
  // ============================================
  async function quickViewPremium(productId) {
      const modalEl = document.getElementById('premiumModal');
      const wrapper = document.getElementById('modal-content-wrapper');
      const modal = new bootstrap.Modal(modalEl);

      wrapper.innerHTML = '<div class="d-flex justify-content-center align-items-center p-5" style="height: 400px;"><div class="spinner-border text-primary"></div></div>';
      modal.show();

      try {
          const response = await fetch(`/api/productos/${productId}`);
          if(!response.ok) throw new Error('Error al obtener datos');
          const p = await response.json();

          const stock = p.stock !== undefined ? p.stock : 0;
          const categoriaNombre = p.nombreCategoria || (p.categoria ? p.categoria.nombre : 'Golden Feets');
          const sku = p.sku || `ID-${p.id}`;

          // Generar opciones de Talla
          let sizeOptions = availableSizes.map(s =>
              `<option value="${s}" ${p.talla === s ? 'selected' : ''}>${s}</option>`
          ).join('');

          // Generar opciones de Color
          let colorOptions = availableColors.map(c =>
              `<option value="${c}" ${p.color === c ? 'selected' : ''}>${c}</option>`
          ).join('');

          wrapper.innerHTML = `
              <button type="button" class="modal-close-btn" data-bs-dismiss="modal">
                  <i class="bi bi-x-lg"></i>
              </button>

              <div class="modal-body-grid">
                  <div class="gallery-section">
                      <div class="main-img-box">
                          <img src="${p.imagenUrl}" id="main-modal-img" alt="${p.nombre}" onerror="this.src='https://via.placeholder.com/500?text=No+Image'">
                      </div>
                  </div>

                  <div class="details-section">
                      <div>
                          <span class="text-uppercase fw-bold text-muted small mb-2 d-block tracking-wide">
                              ${categoriaNombre}
                          </span>
                          <h2 class="modal-title-lg mb-3">${p.nombre}</h2>
                          <p class="text-muted lh-lg">${p.descripcion || 'Sin descripci√≥n disponible.'}</p>
                      </div>

                      <div class="row g-3 mb-2">
                          <div class="col-6">
                              <label class="spec-label mb-2">Talla</label>
                              <select id="modal-size" class="form-select form-select-premium">
                                  ${sizeOptions}
                              </select>
                          </div>
                          <div class="col-6">
                              <label class="spec-label mb-2">Color</label>
                              <select id="modal-color" class="form-select form-select-premium">
                                  ${colorOptions}
                              </select>
                          </div>
                      </div>

                      <div class="spec-grid">
                          <div>
                              <div class="spec-label">Precio</div>
                              <div class="fs-2 fw-black" style="font-family: var(--font-serif); font-weight: 900; color: var(--purple-600);">
                                  ${formatter.format(p.precio)}
                              </div>
                          </div>
                          <div>
                              <div class="spec-label">Disponibilidad</div>
                              <div class="${stock > 0 ? 'text-success' : 'text-danger'} fw-bold d-flex align-items-center gap-1">
                                  <i class="bi ${stock > 0 ? 'bi-check-circle-fill' : 'bi-x-circle-fill'}"></i>
                                  ${stock > 0 ? stock + ' en stock' : 'Agotado'}
                              </div>
                          </div>
                          <div>
                              <div class="spec-label">SKU</div>
                              <div class="spec-value">${sku}</div>
                          </div>
                          <div>
                              <div class="spec-label">Env√≠o</div>
                              <div class="spec-value">Gratis</div>
                          </div>
                      </div>

                      <div class="mt-auto">
                          <div class="d-flex gap-3">
                              <div class="input-group" style="width: 140px; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb;">
                                  <button class="btn btn-light px-3" type="button" onclick="this.nextElementSibling.stepDown()" ${stock === 0 ? 'disabled' : ''}>-</button>
                                  <input type="number" id="modal-quantity" class="form-control text-center border-0 bg-white fw-bold" value="1" min="1" max="${stock}" ${stock === 0 ? 'disabled' : ''}>
                                  <button class="btn btn-light px-3" type="button" onclick="this.previousElementSibling.stepUp()" ${stock === 0 ? 'disabled' : ''}>+</button>
                              </div>

                              <button onclick="addToCartFromModal(${p.id}, '${p.nombre.replace(/'/g, "\\'")}')"
                                      class="btn flex-grow-1 text-white fw-bold fs-5"
                                      ${stock === 0 ? 'disabled' : ''}
                                      style="background: var(--gradient-primary); border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(109, 40, 217, 0.4);">
                                  ${stock > 0 ? '‚úì A√±adir al Carrito' : 'Sin Stock'}
                              </button>
                          </div>
                      </div>
                  </div>
              </div>
          `;

      } catch (err) {
          console.error(err);
          wrapper.innerHTML = '<div class="p-5 text-center text-danger fw-bold">No se pudieron cargar los detalles.</div>';
      }
  }

  // ============================================
  // ‚≠ê A√ëADIR AL CARRITO - CORREGIDO CON VARIANTES
  // ============================================
  function addToCartFromModal(productId, productName) {
      const quantityInput = document.getElementById('modal-quantity');
      const quantity = quantityInput ? (parseInt(quantityInput.value) || 1) : 1;

      // Capturar valores seleccionados
      const selectedSize = document.getElementById('modal-size').value;
      const selectedColor = document.getElementById('modal-color').value;

      // VALIDAR que se haya seleccionado talla y color
      if (!selectedSize || !selectedColor) {
          showToast('‚ö†Ô∏è Selecciona talla y color', 'error');
          return;
      }

      // Llamar a la funci√≥n principal
      addToCart(productName, productId, quantity, selectedSize, selectedColor);

      // Cerrar modal
      const modalEl = document.getElementById('premiumModal');
      const modalInstance = bootstrap.Modal.getInstance(modalEl);
      if (modalInstance) modalInstance.hide();
  }

  /**
   * ‚≠ê FUNCI√ìN PRINCIPAL PARA AGREGAR AL CARRITO
   * Usa el formato de clave: productoId-talla-color
   */
  function addToCart(productName, productId, quantity = 1, size, color) {
      // IMPORTANTE: Validar que tengamos talla y color
      if (!size || !color) {
          console.error('‚ùå Error: Se requiere talla y color');
          showToast('‚ö†Ô∏è Por favor selecciona talla y color', 'error');
          return;
      }

      // ‚≠ê CLAVE √öNICA: productoId-talla-color (ej: "5-34-Negro")
      const cartKey = `${productId}-${size}-${color}`;

      let cart = JSON.parse(localStorage.getItem('goldenFeetsCart')) || {};

      // Si ya existe esta combinaci√≥n exacta, incrementar cantidad
      if (cart[cartKey]) {
          cart[cartKey].quantity += quantity;
          console.log(`‚úÖ Cantidad actualizada para ${cartKey}: ${cart[cartKey].quantity}`);
      } else {
          // Crear nuevo item con todas las propiedades
          cart[cartKey] = {
              productoId: productId,
              quantity: quantity,
              talla: size,
              color: color,
              addedAt: new Date().toISOString()
          };
          console.log(`‚úÖ Nuevo item agregado: ${cartKey}`);
      }

      // Guardar en localStorage
      localStorage.setItem('goldenFeetsCart', JSON.stringify(cart));

      // Actualizar contador
      updateCartCount();

      // Mostrar notificaci√≥n
      const detailsMsg = `Talla ${size} - ${color}`;
      showToast(`‚úì ${productName} (${detailsMsg}) a√±adido al carrito`, 'success');

      console.log('üõí Carrito actualizado:', cart);
  }

  // ============================================
  // ACTUALIZAR CONTADOR DEL CARRITO
  // ============================================
  function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('goldenFeetsCart')) || {};
      const count = Object.values(cart).reduce((sum, item) => sum + (item.quantity || 0), 0);
      const cartCountElement = document.getElementById('cart-count');
      if(cartCountElement) {
          cartCountElement.textContent = count;

          // Animaci√≥n de "pop"
          cartCountElement.style.transform = 'scale(1.3)';
          setTimeout(() => {
              cartCountElement.style.transform = 'scale(1)';
          }, 200);
      }

      console.log(`üõí Total items en carrito: ${count}`);
  }

  // ============================================
  // NOTIFICACIONES MEJORADAS
  // ============================================
  function showToast(msg, type) {
      const toastContainer = document.getElementById('toast-notification');

      const colors = {
          success: 'bg-success',
          error: 'bg-danger',
          info: 'bg-info'
      };

      const icons = {
          success: 'check-circle-fill',
          error: 'exclamation-triangle-fill',
          info: 'info-circle-fill'
      };

      const bgColor = colors[type] || 'bg-dark';
      const icon = icons[type] || 'info-circle';

      const toastHTML = `
          <div class="toast show align-items-center text-white ${bgColor} border-0"
               role="alert" aria-live="assertive" aria-atomic="true"
               style="box-shadow: 0 10px 30px rgba(0,0,0,0.3); border-radius: 12px;">
              <div class="d-flex">
                  <div class="toast-body fw-bold">
                      <i class="bi bi-${icon} me-2"></i> ${msg}
                  </div>
                  <button type="button" class="btn-close btn-close-white me-2 m-auto"
                          data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
          </div>
      `;

      toastContainer.innerHTML = toastHTML;

      setTimeout(() => {
          toastContainer.innerHTML = '';
      }, 3500);
  }
</script>

</body>
</html>